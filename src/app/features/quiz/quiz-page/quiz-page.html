<section class="quiz">
  <h1 class="quiz__title">Angular Quiz</h1>

  @let state = state$$();

  @if (state.status === 'loading' || state.status === 'idle') {
    <p>Loading questionsâ€¦</p>
  } @else if (state.status === 'error') {
    <p>Failed to load questions: {{ state.message }}</p>
  } @else if (question$$() !== null) {
    <div class="quiz__card">
      <p class="quiz__meta">Question {{ questionNumber$$() }} of {{ totalQuestions$$() }}</p>

      <div class="quiz__mode" role="group" aria-label="Mode toggle">
        <label class="quiz__mode-label">
          <input
            type="checkbox"
            [checked]="quizModeEnabled$$()"
            (change)="setQuizModeEnabled($any($event.target).checked)"
          />
          Quiz mode
        </label>
      </div>

      @if (quizModeEnabled$$()) {
        <div class="quiz__nav-row">
          <button type="button" (click)="prev()" [disabled]="!canGoPrev$$()">Prev</button>
          <button type="button" (click)="next()" [disabled]="!canGoNext$$()">Next</button>
        </div>
      }

      <h2 class="quiz__question">{{ question$$()!.question }}</h2>

      @if (quizModeEnabled$$()) {
        <fieldset class="quiz__options" role="radiogroup" aria-label="Answer options">
          @for (option of question$$()!.options; track option.id) {
            <label class="quiz__option">
              <input
                type="radio"
                name="answer"
                [checked]="selectedOptionId$$() === option.id"
                (change)="onSelect(option.id)"
              />
              <span>{{ option.label }}</span>
            </label>
          }
        </fieldset>

        <div class="quiz__check-row">
          <button type="button" (click)="checkAnswer()" [disabled]="!selectedOptionId$$()">
            Check answer
          </button>
        </div>
      }

      <div class="quiz__nav-row">
        <button type="button" (click)="prev()" [disabled]="!canGoPrev$$()">Prev</button>
        <button type="button" (click)="next()" [disabled]="!canGoNext$$()">Next</button>
      </div>

      @if (quizModeEnabled$$() && isCorrect$$() !== null) {
        <p class="quiz__result">
          @if (isCorrect$$()) {
            Correct.
          } @else {
            Incorrect. Correct answer: {{ getCorrectLabel() }}
          }
        </p>
      }

      <details class="quiz__details" [open]="!quizModeEnabled$$()">
        <summary>Explanation</summary>
        <div class="quiz__explanation" [innerHTML]="explanationHtml$$()"></div>
      </details>

      <div class="quiz__pagination-row">
        <div class="quiz__jump" role="group" aria-label="Jump to question">
          <label class="quiz__jump-label" for="jumpTo">Go to</label>
          <input
            id="jumpTo"
            class="quiz__jump-input"
            type="number"
            inputmode="numeric"
            [min]="1"
            [max]="totalQuestions$$()"
            [value]="jumpToQuestion$$()"
            (input)="onJumpInput($any($event.target).value)"
            (keydown.enter)="jump()"
            aria-label="Question number"
          />
          <span class="quiz__jump-total" aria-hidden="true">/ {{ totalQuestions$$() }}</span>
          <button type="button" (click)="jump()" [disabled]="totalQuestions$$() === 0">Go</button>
        </div>
      </div>
    </div>
  }
</section>
